from typing import Tuple

import numpy as np


class FrequencyDetector:
    def __init__(self):
        coefficients_1kHz = [
            -0.002125753777728461,
            -0.0019728549532963408,
            -0.0018023245640827847,
            -0.0016071373171412228,
            -0.0013785204862559418,
            -0.0011067319179557233,
            -0.0007819328097200046,
            -0.0003951114200836797,
            6.098907882325884e-05,
            0.0005909863529285159,
            0.0011960649161563935,
            0.0018733159431962305,
            0.002615249409909879,
            0.0034095103456033204,
            0.004238822771940046,
            0.0050811755454068,
            0.0059102541775084665,
            0.006696112170744384,
            0.007406064917400894,
            0.00800577914912346,
            0.008460521749235774,
            0.008736523786985974,
            0.008802409260048497,
            0.008630633522290133,
            0.008198873914459306,
            0.007491314865088208,
            0.006499771727069356,
            0.005224601825941447,
            0.0036753575083065993,
            0.0018711441800991658,
            -0.00015934384047289812,
            -0.0023781257271309262,
            -0.004738578876672984,
            -0.007186417577054878,
            -0.009660984769457448,
            -0.012096824049738221,
            -0.014425487969881407,
            -0.01657752893016144,
            -0.01848461090666309,
            -0.02008167424007102,
            -0.02130908198122049,
            -0.022114675013029567,
            -0.022455664447534416,
            -0.02230029360456121,
            -0.02162920811917533,
            -0.020436481256741832,
            -0.018730251981443635,
            -0.01653294548573592,
            -0.01388105925992451,
            -0.010824511939611644,
            -0.007425566642937566,
            -0.0037573547959627277,
            9.796001129713538e-05,
            0.004051326175112529,
            0.008009193468056857,
            0.011876076138025837,
            0.015557211681303857,
            0.018961233347636226,
            0.0220027732153632,
            0.0246049142273261,
            0.02670141385583951,
            0.02823862894548542,
            0.02917708051972885,
            0.02949260865357479,
            0.02917708051972885,
            0.02823862894548542,
            0.02670141385583951,
            0.0246049142273261,
            0.0220027732153632,
            0.018961233347636223,
            0.015557211681303857,
            0.011876076138025837,
            0.008009193468056857,
            0.004051326175112528,
            9.796001129713538e-05,
            -0.0037573547959627277,
            -0.007425566642937565,
            -0.010824511939611642,
            -0.01388105925992451,
            -0.01653294548573592,
            -0.01873025198144363,
            -0.020436481256741832,
            -0.021629208119175326,
            -0.022300293604561202,
            -0.022455664447534402,
            -0.022114675013029567,
            -0.02130908198122049,
            -0.020081674240071012,
            -0.01848461090666308,
            -0.01657752893016143,
            -0.014425487969881407,
            -0.012096824049738218,
            -0.009660984769457445,
            -0.007186417577054876,
            -0.004738578876672984,
            -0.002378125727130926,
            -0.00015934384047289803,
            0.0018711441800991647,
            0.003675357508306596,
            0.005224601825941447,
            0.006499771727069354,
            0.007491314865088205,
            0.0081988739144593,
            0.008630633522290133,
            0.008802409260048497,
            0.008736523786985969,
            0.008460521749235771,
            0.008005779149123447,
            0.007406064917400894,
            0.006696112170744384,
            0.005910254177508461,
            0.005081175545406793,
            0.004238822771940041,
            0.0034095103456033204,
            0.002615249409909878,
            0.0018733159431962298,
            0.001196064916156392,
            0.0005909863529285159,
            6.098907882325884e-05,
            -0.0003951114200836795,
            -0.0007819328097200046,
            -0.0011067319179557226,
            -0.0013785204862559418,
            -0.0016071373171412228,
            -0.0018023245640827847,
            -0.0019728549532963408,
            -0.002125753777728461,
        ]
        coefficients_2kHz = [
            0.0014703198292358491,
            0.0008991195916871728,
            0.00025010610807579267,
            -0.00045339347955078966,
            -0.0011818112002014737,
            -0.0018964287565880614,
            -0.0025480162193816263,
            -0.0030777509893238964,
            -0.0034207983184745476,
            -0.00351249616988716,
            -0.003296621941608282,
            -0.0027347935653062854,
            -0.0018157368646476372,
            -0.0005629876633312246,
            0.0009603749140651962,
            0.002651137926680603,
            0.004370265546196473,
            0.005952310198963274,
            0.007219480535974331,
            0.00799927504007507,
            0.00814401865830578,
            0.0075502223042588365,
            0.006175484731709377,
            0.00405071378075236,
            0.0012857712938716531,
            -0.0019327764322462514,
            -0.005352343356970476,
            -0.008673083675615846,
            -0.011573438923069918,
            -0.013740332196625538,
            -0.0149011951185354,
            -0.014854602682567762,
            -0.013496205984342839,
            -0.010836921100107873,
            -0.0070109446300285145,
            -0.002272074732622171,
            0.003022061607135375,
            0.008437048294913964,
            0.013497955407710352,
            0.017731764058542942,
            0.0207120682139789,
            0.02210175628264149,
            0.02168937213306436,
            0.019415290782190345,
            0.015384689952211542,
            0.009865483228930615,
            0.003270793962012491,
            -0.0038729451685779364,
            -0.010969734144324356,
            -0.017405814740961447,
            -0.0226048683339988,
            -0.026081457311674522,
            -0.02748759373146441,
            -0.026647851565339588,
            -0.023579433457985598,
            -0.018494969579070573,
            -0.011787436343513896,
            -0.0039982807718025645,
            0.004228544058266442,
            0.01220254700721839,
            0.01924758291873346,
            0.0247620444966018,
            0.028272769318584044,
            0.029477623879037896,
            0.028272769318584044,
            0.0247620444966018,
            0.019247582918733457,
            0.01220254700721839,
            0.004228544058266442,
            -0.0039982807718025645,
            -0.011787436343513896,
            -0.018494969579070573,
            -0.023579433457985598,
            -0.026647851565339584,
            -0.02748759373146441,
            -0.026081457311674522,
            -0.022604868333998798,
            -0.017405814740961447,
            -0.010969734144324356,
            -0.0038729451685779364,
            0.0032707939620124906,
            0.009865483228930615,
            0.01538468995221154,
            0.01941529078219034,
            0.021689372133064346,
            0.02210175628264149,
            0.0207120682139789,
            0.017731764058542935,
            0.013497955407710347,
            0.008437048294913959,
            0.003022061607135375,
            -0.0022720747326221706,
            -0.007010944630028513,
            -0.01083692110010787,
            -0.013496205984342839,
            -0.014854602682567759,
            -0.014901195118535394,
            -0.013740332196625531,
            -0.011573438923069909,
            -0.008673083675615846,
            -0.005352343356970474,
            -0.0019327764322462505,
            0.001285771293871652,
            0.00405071378075236,
            0.006175484731709377,
            0.0075502223042588305,
            0.008144018658305779,
            0.007999275040075058,
            0.007219480535974331,
            0.005952310198963274,
            0.00437026554619647,
            0.0026511379266805995,
            0.0009603749140651951,
            -0.0005629876633312246,
            -0.001815736864647636,
            -0.002734793565306284,
            -0.003296621941608278,
            -0.00351249616988716,
            -0.0034207983184745476,
            -0.0030777509893238947,
            -0.0025480162193816263,
            -0.0018964287565880603,
            -0.0011818112002014737,
            -0.00045339347955078966,
            0.00025010610807579267,
            0.0008991195916871728,
            0.0014703198292358491,
        ]

        self.coefficients_1kHz = np.array(coefficients_1kHz)
        self.coefficients_2kHz = np.array(coefficients_2kHz)
        self.buffer = np.zeros(len(coefficients_1kHz))

    def detect(self, sample: float) -> Tuple[float, float]:
        self.buffer = np.roll(self.buffer, 1)
        self.buffer[0] = sample
        power_1kHz = np.dot(self.buffer, self.coefficients_1kHz)
        power_2kHz = np.dot(self.buffer, self.coefficients_2kHz)

        return power_1kHz, power_2kHz
